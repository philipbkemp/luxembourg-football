<!DOCTYPE html>
<html>
    <head>
        <title>LuxFoot | Seasons</title>
        <link href="styles.css" rel="stylesheet" />
    </head>
    <body>
        <h1>Luxembourgish Football: Seasons</h1>
        <a href="index.html">Home</a> | <a href="seasons.html">Seasons</a>
        <script>
            params=[];
            window.location.search.replace("?","").split("&").forEach(param=>{parts=param.split("=");params[parts[0]]=parts[1];});
            season = params.year;
            seasonPath = [season[0]+""+season[1],season[2],season[3]+"-"+season.split("-")[1]];
            fetch("seasons/"+seasonPath.join("/")+".json")
                .then(response => {
                    if ( ! response.ok ) {
                        console.error(error.message);
                        return {"invalid":true};
                    }
                    return response.json()
                })
                .then(data => {
                    if ( data.invalid ) {
                        return;
                    }
                    document.getElementsByTagName("title")[0].textContent += " | " + data.season;
                    document.getElementsByTagName("h1")[0].textContent += " : " + data.season;

                    // leagues
                    data.league.forEach(league=>{
                        h2 = document.createElement("H2");
                        h2.textContent = league.name;
                        h2.id = "league_" + league.level;
                        document.body.append(h2);

                        if ( league.standings ) {
                            drawStandings(league.standings,league.pts_win??3);
                        }
                    });
                });
            
            function drawStandings(standingsData,pts=3) {
                table = document.createElement("TABLE");
                
                thead = document.createElement("THEAD");
                thead_tr = document.createElement("TR");
                
                th_place = document.createElement("TH");
                th_place.textContent = "#";
                thead_tr.append(th_place);

                th_team = document.createElement("TH");
                th_team.textContent = "Team";
                thead_tr.append(th_team);

                stats = [
                    ["P","Played"],
                    ["W","Won"],
                    ["D","Draw"],
                    ["L","Lost"],
                    ["F","Goals For"],
                    ["A","Goals Against"],
                    ["Pts","Points"],
                    ["GD","Goal Difference"]
                ];
                stats.forEach(s=>{
                    th_stat = document.createElement("TH");
                    th_stat_abbr = document.createElement("ABBR");
                    th_stat_abbr.textContent = s[0];
                    th_stat_abbr.title = s[1];
                    th_stat.append(th_stat_abbr);
                    thead_tr.append(th_stat);
                });

                thead.append(thead_tr);
                table.append(thead);

                tbody = document.createElement("TBODY");
                
                standingsData.forEach(row=>{
                    tbody_tr = document.createElement("TR");

                    tr_place = document.createElement("TD");
                    tr_place.textContent = row.place;
                    tbody_tr.append(tr_place);

                    tr_team = document.createElement("TD");
                    tr_team.textContent = row.team;
                    tbody_tr.append(tr_team);

                    stats = ["p","w","d","l","f","a"];
                    stats.forEach(s=>{
                        td_stat = document.createElement("TH");
                        td_stat.textContent = row[s];
                        tbody_tr.append(td_stat);
                    });
                    td_stat = document.createElement("TH");
                    td_stat.textContent = row.f - row.a;
                    tbody_tr.append(td_stat);

                    td_stat = document.createElement("TH");
                    td_stat.textContent = (row.w*pts) + row.d;
                    tbody_tr.append(td_stat);

                    tbody.append(tbody_tr);
                });

                table.append(tbody);

                document.body.append(table);
            }
        </script>
    </body>
</html>